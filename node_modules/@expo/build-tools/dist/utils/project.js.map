{"version":3,"file":"project.js","sourceRoot":"","sources":["../../src/utils/project.ts"],"names":[],"mappings":";;;;;AAAA,gDAAwB;AAKxB,iCAAmC;AACnC,oDAA4B;AAI5B,KAAK,UAAU,KAAK,CAAC,GAAoB;IACvC,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC;IAE5B,MAAM,cAAc,GAAG,cAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;IAC1D,MAAM,cAAc,GAAG,cAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,gBAAgB,CAAC,CAAC;IAEnE,MAAM,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,GAAG,CAAC,UAAU,EAAE,EAAE,0BAA0B,CAAC,CAAC;IACxE,MAAM,gBAAS,CAAC,GAAG,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;IAEhD,MAAM,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;IACzC,MAAM,eAAK,CACT,KAAK,EACL,CAAC,oBAAoB,EAAE,GAAG,EAAE,MAAM,EAAE,gBAAgB,EAAE,IAAI,EAAE,cAAc,CAAC,EAC3E,EAAE,GAAG,EAAE,GAAG,CAAC,UAAU,EAAE,MAAM,EAAE,CAChC,CAAC;IAEF,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC5B,MAAM,eAAK,CAAC,MAAM,EAAE,CAAC,SAAS,CAAC,EAAE,EAAE,GAAG,EAAE,cAAc,EAAE,MAAM,EAAE,CAAC,CAAC;IAElE,MAAM,sBAAsB,GAAG,cAAI,CAAC,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC,sBAAsB,CAAC,CAAC;IAErF,OAAO;QACL,cAAc;QACd,sBAAsB;KACvB,CAAC;AACJ,CAAC;AAEQ,sBAAK","sourcesContent":["import path from 'path';\n\nimport { BuilderCtx } from '../context';\nimport { BaseAndroidJob } from '../platforms/android/baseJob';\nimport { BaseiOSJob } from '../platforms/ios/baseJob';\nimport { fetchFile } from './file';\nimport spawn from './spawn';\n\ntype Job = BaseAndroidJob | BaseiOSJob;\n\nasync function setup(ctx: BuilderCtx<Job>) {\n  const { job, logger } = ctx;\n\n  const buildDirectory = path.join(ctx.workingdir, 'build');\n  const projectTarball = path.join(ctx.workingdir, 'project.tar.gz');\n\n  logger.info({ projectUrl: job.projectUrl }, 'Download project archive');\n  await fetchFile(job.projectUrl, projectTarball);\n\n  logger.info('Unpacking project archive');\n  await spawn(\n    'tar',\n    ['--strip-components', '1', '-zxf', 'project.tar.gz', '-C', buildDirectory],\n    { cwd: ctx.workingdir, logger },\n  );\n\n  logger.info('Running yarn');\n  await spawn('yarn', ['install'], { cwd: buildDirectory, logger });\n\n  const nativeProjectDirectory = path.join(buildDirectory, job.nativeProjectDirectory);\n\n  return {\n    buildDirectory,\n    nativeProjectDirectory,\n  };\n}\n\nexport { setup };\n"]}