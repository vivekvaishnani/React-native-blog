import fs from 'fs-extra';
import got from 'got';

const MAX_S3_FILE_FETCH_TIMOEUT = 1000 * 60 * 20;

async function fetchFile(srcUrl: string, outputPath: string, timeout: number = MAX_S3_FILE_FETCH_TIMOEUT) {
  const writeStream = fs.createWriteStream(outputPath);
  const stream = got.stream(srcUrl, { timeout });
  stream.pipe(writeStream);

  await new Promise((res, rej) => {
    stream.on('end', () => res());
    stream.on('error', (err) => rej(err));
  });
}

export { fetchFile };
