import Joi from '@hapi/joi';

import { BuildType } from '../../constants';
import { GenericiOSJob, GenericiOSJobSchema } from './generic/job';
import { ManagediOSJob, ManagediOSJobSchema } from './managed/job';

type iOSJob = GenericiOSJob | ManagediOSJob;

const iOSJobSchema = Joi.object({
  type: Joi.string().valid(...Object.values(BuildType)).required(),
})
  .when(
    Joi.object({ type: BuildType.Generic }).unknown(),
    { then: GenericiOSJobSchema },
  )
  .when(
    Joi.object({ type: BuildType.Managed }).unknown(),
    { then: ManagediOSJobSchema },
  );

export {
  iOSJob,
  iOSJobSchema,
};
