import bunyan from 'bunyan';

import spawn from '../../../utils/spawn';

interface FastlaneOptions {
  logger?: bunyan;
  envs?: { [key: string]: string; };
  cwd?: string;
}

async function runFastlane(fastlaneArgs: string[], { logger, envs, cwd }: FastlaneOptions = {}) {
  const fastlaneEnvVars = {
    FASTLANE_DISABLE_COLORS: '1',
    FASTLANE_SKIP_UPDATE_CHECK: '1',
    CI: '1',
    LC_ALL: 'en_US.UTF-8',
    ...envs,
  };
  return await spawn(
    'fastlane',
    fastlaneArgs,
    {
      env: { ...process.env, ...fastlaneEnvVars },
      logger,
      cwd,
    },
  );
}

export default runFastlane;
