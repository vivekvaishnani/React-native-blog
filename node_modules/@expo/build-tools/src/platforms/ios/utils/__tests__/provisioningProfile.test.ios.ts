import bunyan from 'bunyan';

import ProvisioningProfile from '../provisioningProfile';
import { provisioningProfile } from './fixtures';

const logger = bunyan.createLogger({ level: 'error', name: 'provisioningProfileTest' });

describe('ProvisioningProfile class', () => {
  describe('verifyCertificate method', () => {
    let pp: ProvisioningProfile;

    beforeAll(async () => {
      pp = new ProvisioningProfile(logger, Buffer.from(provisioningProfile.dataBase64, 'base64'));
    });

    afterAll(async () => {
      pp.destroy();
    });

    it(`shouldn't throw any error if the provisioning profile and distribution certificate match`, async () => {
      await pp.init();

      await expect(
        pp.verifyCertificate(provisioningProfile.certFingerprint),
      ).resolves.not.toThrow();
    });

    it(`should throw an error if the provisioning profile and distribution certificate don't match`, async () => {
      await pp.init();

      await expect(
        pp.verifyCertificate('2137'),
      ).rejects.toThrowError(/don't match/);
    });
  });
});
