import Joi from '@hapi/joi';

import { Platform } from '../../constants';

const iOSCredentialsSchema = Joi.object().keys({
  provisioningProfileBase64: Joi.string().required(),
  distributionCertificate: Joi.object({
    dataBase64: Joi.string().required(),
    password: Joi.string().required(),
  }).required(),
});

interface iOSCredentials {
  provisioningProfileBase64: string;
  distributionCertificate: DistributionCertificate;
}

interface DistributionCertificate {
  dataBase64: string;
  password: string;
}

const BaseiOSJobSchema = Joi.object().keys({
  platform: Joi.string().valid(Platform.iOS).required(),
  projectUrl: Joi.string().uri().required(),
  nativeProjectDirectory: Joi.string().default('ios'),
  credentials: iOSCredentialsSchema.required(),
});

interface BaseiOSJob {
  platform: Platform.iOS;
  projectUrl: string;
  nativeProjectDirectory: string;
  credentials: iOSCredentials;
}

export { BaseiOSJob, BaseiOSJobSchema, iOSCredentials, DistributionCertificate };
