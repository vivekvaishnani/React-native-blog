import Joi from '@hapi/joi';

import { BuildType } from '../../constants';
import { GenericAndroidJob, GenericAndroidJobSchema } from './generic/job';
import { ManagedAndroidJob, ManagedAndroidJobSchema } from './managed/job';

type AndroidJob = GenericAndroidJob | ManagedAndroidJob;

const AndroidJobSchema = Joi.object({
  type: Joi.string().valid(...Object.values(BuildType)).required(),
})
  .when(
    Joi.object({ type: BuildType.Generic }).unknown(),
    { then: GenericAndroidJobSchema },
  )
  .when(
    Joi.object({ type: BuildType.Managed }).unknown(),
    { then: ManagedAndroidJobSchema },
  );

export {
  AndroidJob,
  AndroidJobSchema,
};
